================================================================================
WINDFOIL BLADE OPTIMIZATION - TECHNICAL DOCUMENTATION
MAE 4272 Design Project
================================================================================

ABSTRACT
========
This optimization uses differential evolution to find the ideal blade pitch angle 
distribution and operating RPM for a windfoil turbine that maximizes expected power 
output under real-world wind conditions. The algorithm balances aerodynamic efficiency 
against structural stress limits by testing thousands of design configurations and 
selecting those that produce the most power over a Weibull wind speed distribution 
while staying within a 29.33 MPa stress safety limit. The result is a blade design 
with varying pitch angles along its length that adapts optimally to the statistical 
wind patterns at the deployment site.


================================================================================
1. PROJECT OVERVIEW & OBJECTIVES
================================================================================

PURPOSE:
--------
Design an optimal windfoil turbine blade that generates maximum power under 
real-world wind conditions while meeting safety and structural requirements.

KEY QUESTION:
-------------
"What pitch angle should each section of the blade have, and at what RPM should 
we operate the turbine to get the most power output on average?"

WHY THIS MATTERS:
-----------------
- Wind speed varies constantly - it's not always 10 m/s
- Different wind speeds occur with different probabilities (Weibull distribution)
- We need a blade design that performs well across the full range of wind speeds
- The blade must survive high wind loads without breaking (stress constraints)
- Finding this optimal design manually would require testing millions of combinations


================================================================================
2. DESIGN CONSTRAINTS
================================================================================

GEOMETRIC CONSTRAINTS:
----------------------
- Blade Length: Maximum 6 inches (0.1524 m)
- Hub Radius: 1 inch (0.0254 m) - blade starts here
- Total Radius: 7 inches (0.1778 m) from center
- Airfoil: NACA 4412 profile (selected after comparing with S822 airfoil)
- Number of Radial Stations: 10 (10 pitch angles along blade)
- Number of Blades: 1 (single blade analysis)

OPERATIONAL CONSTRAINTS:
------------------------
- Maximum RPM: 2000 (limited by structural/safety concerns)
- Operating Range: Tested from 100 to 2000 RPM

STRUCTURAL CONSTRAINTS:
-----------------------
- Material Failure Stress: 44 MPa
- Safety Factor: 1.5x
- Maximum Allowable Stress: 29.33 MPa (44 MPa / 1.5)
- Any design exceeding this stress is automatically rejected

ENVIRONMENTAL CONDITIONS:
-------------------------
- Wind Speed Distribution: Weibull (k=5.0, c=5.0 m/s)
- Mean Wind Speed: ~4.5 m/s
- Air Density: 1.225 kg/m³ (standard sea level)


================================================================================
3. WHAT IS BEING OPTIMIZED?
================================================================================

OPTIMIZATION VARIABLES (12 total):
-----------------------------------
1. Pitch Angles at 10 radial stations (10 variables)
   - Pitch angle at hub (25.4 mm from center)
   - Pitch angle at 2nd station
   - ... (8 more stations)
   - Pitch angle at tip (177.8 mm from center)
   - Range: 0° to 45° at each station

2. Operating RPM (1 variable)
   - Target operating speed controlled by brake
   - Range: 100 to 2000 RPM

TOTAL SEARCH SPACE:
-------------------
Each pitch angle can be anywhere from 0° to 45° (45° range)
RPM can be anywhere from 1500 to 1900 (400 range)
Chord root anywhere from 1 to 2 inches (0.0254 m range)
This creates an enormous multi-dimensional search space with infinite possible 
combinations - impossible to test exhaustively!


================================================================================
4. OPTIMIZATION APPROACH: DIFFERENTIAL EVOLUTION
================================================================================

WHAT IS DIFFERENTIAL EVOLUTION?
--------------------------------
Differential evolution is a genetic algorithm that mimics natural selection to 
find optimal solutions. Think of it as "survival of the fittest" for blade designs.

HOW IT WORKS:
-------------

STEP 1: INITIALIZE POPULATION
- Create 15 random blade designs (population size = 15)
- Each design has random pitch angles and RPM within the allowed bounds
- This gives us diverse starting points

STEP 2: EVALUATE FITNESS
- For each blade design, calculate the "expected power output"
- This means testing the design at many wind speeds (1-20 m/s)
- Weight each wind speed by how often it occurs (Weibull probability)
- Check if the design violates stress limits
- If stress is exceeded, heavily penalize this design

STEP 3: CREATE NEW DESIGNS (MUTATION & CROSSOVER)
- Take three random existing designs (A, B, C)
- Create a mutant: Mutant = A + 0.8 × (B - C)
- This creates a new design by combining features of existing ones
- Mix the mutant with an existing design to create a trial design

STEP 4: SELECTION
- Compare trial design to current design
- Keep whichever produces more power
- Bad designs die out, good designs survive and reproduce

STEP 5: ITERATE
- Repeat steps 2-4 for 50 generations
- Each generation, the population improves
- Eventually converges to the optimal design

WHY THIS WORKS:
---------------
- Explores the entire design space efficiently
- Doesn't get stuck in local optima (tests diverse designs)
- Automatically balances exploration (trying new things) vs exploitation 
  (refining good designs)
- Handles constraints naturally through penalties
- Proven effective for complex engineering optimization


================================================================================
5. THE PHYSICS: HOW POWER IS CALCULATED
================================================================================

For each blade design and wind condition, the code calculates:

AERODYNAMIC ANALYSIS (for each blade segment):
-----------------------------------------------

1. VELOCITY TRIANGLE:
   - Wind speed (U): incoming wind velocity
   - Rotational speed (ωr): blade segment speed due to rotation
   - Relative wind (W): what the blade "sees" = √(U² + (ωr)²)
   - Flow angle (β): angle of relative wind

2. ANGLE OF ATTACK:
   - Flow angle (φ): 90° - β (perpendicular component)
   - Pitch angle (θ): blade twist at this location
   - Angle of attack (α): φ - θ
   - This determines lift and drag from airfoil data

3. LIFT AND DRAG:
   - Look up Cl and Cd from NACA 4412 polar data for angle α
   - Calculate lift force: L = 0.5 × ρ × W² × chord × Cl
   - Calculate drag force: D = 0.5 × ρ × W² × chord × Cd

4. FORCE DECOMPOSITION:
   - Normal force (Fn): force perpendicular to rotation plane
     Fn = L·sin(β) + D·sin(φ)
   - Tangential force (Ft): force driving rotation
     Ft = L·cos(β) - D·cos(φ)

5. TORQUE AND POWER:
   - Torque from segment: Q_segment = r × Ft
   - Total torque: Q = Σ(Q_segment) for all segments
   - Power: P = Q × ω (torque × angular velocity)

INTEGRATION OVER WIND SPEEDS:
------------------------------
- Calculate power at each wind speed (1, 2, 3, ... 20 m/s)
- Weight by Weibull probability density
- Expected Power = Σ(Power(U) × Probability(U) × ΔU)
- This gives the average power over all wind conditions


================================================================================
6. STRUCTURAL STRESS ANALYSIS
================================================================================

WHY STRESS MATTERS:
-------------------
The normal forces on the blade create bending moments that could snap the blade.
We must ensure the blade survives the worst-case loads.

STRESS CALCULATION PROCESS:
----------------------------

1. COLLECT NORMAL FORCES:
   - Normal force on each segment from aerodynamic analysis
   - These act perpendicular to the blade span

2. CALCULATE BENDING MOMENTS:
   - At each radial station, sum forces from all outboard segments
   - Moment at station k: M_k = Σ(F_n × distance)
   - Tip has zero moment, hub has maximum moment

3. CALCULATE BENDING STRESS:
   - For each station, find the chord length (c)
   - Thickness: h = 0.12 × c (12% thickness ratio)
   - Second moment of area: I = I_non_dim × c⁴
   - Distance to edge: y = h/2
   - Stress: σ = M × y / I (beam bending equation)

4. CHECK CONSTRAINT:
   - Find maximum stress along blade: σ_max
   - If σ_max > 29.33 MPa, design FAILS
   - Failed designs get massive penalty in optimization

NACA 4412 MOMENT OF INERTIA:
-----------------------------
The code calculates the exact cross-sectional shape of the NACA 4412 airfoil:
- Upper surface and lower surface coordinates
- Integrates to find area, centroid, and second moment
- Result: I_non_dim ≈ 5.46 × 10⁻⁵ (non-dimensional)
- Scales with chord: I_actual = I_non_dim × chord⁴


================================================================================
7. WEIBULL WIND DISTRIBUTION
================================================================================

WHAT IS WEIBULL DISTRIBUTION?
------------------------------
A statistical model that describes how often different wind speeds occur at a 
location. It's more realistic than assuming constant wind.

PARAMETERS:
-----------
- Shape parameter (k): 5.0 (determines distribution shape)
- Scale parameter (c): 5.0 m/s (characteristic wind speed)
- Mean wind speed: c × Γ(1 + 1/k) ≈ 4.5 m/s

PROBABILITY DENSITY FUNCTION:
------------------------------
PDF(U) = (k/c) × (U/c)^(k-1) × exp(-(U/c)^k)

INTERPRETATION:
---------------
- Most common winds: 3-6 m/s (peak of distribution)
- Rare high winds: 15-20 m/s (tail of distribution)
- Very low winds: <2 m/s (less common)
- Zero wind: doesn't contribute to power

WHY THIS MATTERS FOR OPTIMIZATION:
-----------------------------------
- A blade optimized for 10 m/s might perform poorly at 5 m/s
- But 5 m/s occurs much more frequently!
- Expected power weighs performance by probability
- Result: optimal design favors common wind speeds over rare extremes


================================================================================
8. HOW THE OPTIMIZATION LOOP WORKS (STEP-BY-STEP)
================================================================================

For each candidate blade design tested by differential evolution:

STEP 1: CREATE BLADE GEOMETRY
- Input: 20 pitch angles + 1 RPM value
- Output: Arrays of (radius, pitch, chord) at 20 stations
- Chord uses linear taper (40mm at hub → 20mm at tip)

STEP 2: SET UP WIND SPEED SAMPLES
- Create array: U = [1, 2, 3, ..., 20] m/s (20 samples)
- Calculate Weibull probability for each
- Set integration weight: ΔU = 1.0 m/s

STEP 3: LOOP OVER WIND SPEEDS
For each wind speed U:

  3a. CALCULATE AERODYNAMICS
      - Call calculate_forces_and_torque(U, RPM, pitch_angles)
      - Returns: Q (torque), Fn (normal forces), r_mid (segment radii)
  
  3b. CHECK STRESS CONSTRAINT
      - Call calculate_max_stress(Fn, r_mid, geometry)
      - Returns: σ_max (maximum stress in blade)
      - If σ_max > 29.33 MPa → constraint violated!
  
  3c. CALCULATE POWER
      - If constraint OK: P = Q × ω = Q × (2π × RPM / 60)
      - If constraint violated: P = 0 (design rejected for this wind)
  
  3d. WEIGHT BY PROBABILITY
      - PDF = weibull_pdf(U)
      - Contribution = P × PDF × ΔU
      - Add to expected_power

STEP 4: APPLY PENALTIES
- If any wind speed violated stress: add penalty = 1,000,000
- This makes bad designs "look" like they produce negative power

STEP 5: RETURN NEGATIVE EXPECTED POWER
- Differential evolution minimizes the objective
- We want to maximize power
- So return: -(expected_power) + penalty
- Best designs have most negative objective value

STEP 6: DIFFERENTIAL EVOLUTION UPDATES
- Algorithm decides if this design is better than previous
- Updates population for next generation
- After 50 generations × 15 population × ~50 evaluations = ~37,500 designs tested


================================================================================
9. OUTPUT FILES AND THEIR MEANING
================================================================================

FILE: optimal_blade_parameters.csv
-----------------------------------
Contains the optimized blade geometry:

Column: radial_position_mm
- Distance from turbine center (25.4 to 177.8 mm)
- 20 stations along blade

Column: pitch_angle_deg
- Optimal pitch angle at each station
- Typically decreases from hub to tip (blade twist)
- Example: 35° at hub → 15° at tip

Column: optimal_rpm
- Target operating speed
- Typical range: 1200-1800 RPM
- Controlled by torque brake

HOW TO USE:
- Manufacture blade with specified pitch at each radial station
- Adjust brake torque to maintain optimal RPM
- Blade will produce near-maximum expected power


FILE: optimal_blade_design.png
-------------------------------
Four-panel visualization:

Panel 1: Blade Geometry
- Blue line: pitch angle vs radius
- Red line: chord length vs radius
- Shows blade twist distribution

Panel 2: Power Output
- Power vs wind speed at optimal RPM
- Peak power typically at 8-12 m/s
- Zero power below cut-in speed

Panel 3: Structural Stress
- Max stress vs wind speed
- Red dashed line: safety limit (29.33 MPa)
- Must stay below this line

Panel 4: Weibull Distribution
- Blue: probability of each wind speed
- Green: weighted power contribution
- Shows which winds matter most


FILE: smoothed_blade_parameters.csv (from enhanced_analysis.py)
----------------------------------------------------------------
Contains polynomial-smoothed pitch angles for easier manufacturing:

- Fits 4th-degree polynomial to raw optimized angles
- Smoother distribution, easier to fabricate
- Minimal performance loss vs raw optimization
- Use this for actual blade construction


FILE: smooth_pitch_analysis.png
--------------------------------
Shows difference between raw optimized and smoothed pitch angles:
- Typically differ by <2° at any station
- Validates that smoothing doesn't hurt performance


FILE: power_vs_rpm_analysis.png
--------------------------------
Two panels analyzing RPM selection:

Panel 1: Power vs RPM at mean wind speed
- Shows optimal operating point
- Peak power typically at 1400-1600 RPM
- Confirms differential evolution found the right RPM

Panel 2: Torque vs RPM
- Shows torque brake requirement
- Torque needed to maintain optimal RPM


================================================================================
10. ENHANCED ANALYSIS TOOLS (enhanced_analysis.py)
================================================================================

This script runs after optimization to provide:

1. SMOOTH PITCH FUNCTION:
   - Fits polynomial to raw optimized angles
   - Provides mathematical function: θ(r) = a₀ + a₁r + a₂r² + a₃r³ + a₄r⁴
   - Easier to implement in CAD/manufacturing
   - Validates optimization quality

2. POWER VS RPM CURVES:
   - Tests performance at different RPMs
   - Identifies peak power operating point
   - Confirms optimal RPM from main optimization

3. TORQUE BRAKE SPECIFICATIONS:
   - Calculates required brake torque
   - Lists torque vs wind speed
   - Provides operational guidance
   - Typical brake torque: 0.001-0.010 N·m

4. PERFORMANCE TABLES:
   - Power output at each wind speed
   - Stress levels at each wind speed
   - Validates design safety across conditions


================================================================================
11. KEY OPTIMIZATION INSIGHTS
================================================================================

WHAT THE ALGORITHM LEARNED:
----------------------------

1. BLADE TWIST IS CRITICAL:
   - Hub sections need higher pitch angles (~30-40°)
   - Tip sections need lower pitch angles (~10-20°)
   - This accounts for varying blade speeds along radius
   - Tip moves faster, sees different relative wind

2. RPM SELECTION BALANCES POWER AND STRESS:
   - Higher RPM → more power
   - Higher RPM → more stress
   - Optimal typically 1400-1600 RPM
   - Well below 2000 RPM limit due to stress

3. DESIGN FAVORS MODERATE WINDS:
   - Optimized for 4-8 m/s range
   - These winds occur most frequently (Weibull peak)
   - Less optimization effort on rare high/low winds
   - This maximizes expected (average) power

4. STRESS CONSTRAINT IS ACTIVE:
   - Many high-power designs rejected due to stress
   - Final design operates near stress limit at high winds
   - Safety factor ensures reliability

5. CHORD DISTRIBUTION MATTERS:
   - Linear taper reduces tip stress
   - Maintains adequate strength at hub
   - Balances aerodynamic and structural needs


================================================================================
12. VALIDATION AND QUALITY CHECKS
================================================================================

The optimization results can be validated by checking:

1. STRESS CONSTRAINT:
   - Max stress < 29.33 MPa at all wind speeds
   - Should approach limit at high winds (15-20 m/s)
   - Large safety margin at low winds

2. PHYSICAL REASONABLENESS:
   - Pitch angles decrease from hub to tip (typical blade twist)
   - RPM in reasonable range (not at artificial bounds)
   - Power increases with wind speed (except at extreme values)

3. SMOOTH DISTRIBUTIONS:
   - Pitch angles don't oscillate wildly
   - Smooth polynomial fit is close to raw optimization
   - No discontinuities or jumps

4. PERFORMANCE METRICS:
   - Expected power > 0.5 W (typical for this size)
   - Peak power at moderate wind speeds (8-12 m/s)
   - Reasonable torque levels (0.001-0.010 N·m)


================================================================================
13. HOW TO INTERPRET THE RESULTS
================================================================================

OPTIMAL BLADE DESIGN SUMMARY:
------------------------------
The optimization finds a blade design that:

✓ Generates maximum average power under real wind conditions
✓ Survives maximum expected loads with safety margin
✓ Operates efficiently across the full wind speed range
✓ Uses manufacturable geometry (smooth distributions)

TRADE-OFFS MADE:
----------------
- Sacrifices peak power at rare wind speeds
- Focuses on common wind speeds for higher average power
- Stays within stress limits (sacrifices some high-wind power)
- Uses smooth geometry (sacrifices theoretical optimum for practicality)

WHAT SUCCESS LOOKS LIKE:
-------------------------
✓ Expected power: 0.5-2.0 W (typical for this blade size)
✓ Optimization converges (success = True)
✓ Stress stays below 29.33 MPa at all tested wind speeds
✓ Smooth pitch distribution (no wild oscillations)
✓ RPM in middle of range (1200-1800 typical)
✓ Polynomial fit differs from raw by <2° everywhere


================================================================================
14. PRACTICAL IMPLEMENTATION GUIDE
================================================================================

TO BUILD THE OPTIMIZED BLADE:
------------------------------

1. USE SMOOTHED PARAMETERS:
   - Read smoothed_blade_parameters.csv
   - Use smooth pitch angles (easier to manufacture)
   - Implement linear chord taper: 40mm → 20mm

2. MANUFACTURING:
   - Create blade template at each radial station
   - Twist blade according to pitch schedule
   - Maintain NACA 4412 profile at all stations
   - Use specified chord at each location

3. OPERATION:
   - Install torque brake
   - Set brake to optimal RPM (from CSV)
   - Brake torque typically 0.001-0.010 N·m
   - Maintain RPM under varying wind conditions

4. TESTING:
   - Measure power output at different wind speeds
   - Compare to predicted curve (optimal_blade_design.png)
   - Verify stress levels stay safe
   - Adjust brake if needed for optimal performance


================================================================================
15. SUMMARY: WHY THIS OPTIMIZATION WORKS
================================================================================

The differential evolution algorithm successfully finds the optimal blade 
design by:

1. EXPLORING VAST DESIGN SPACE:
   - Tests tens of thousands of designs efficiently
   - Doesn't get trapped in poor local optima
   - Balances exploration vs exploitation

2. INCORPORATING REAL PHYSICS:
   - Uses actual aerodynamic theory (blade element momentum)
   - Includes structural mechanics (bending stress)
   - Accounts for realistic wind statistics (Weibull)

3. ENFORCING CONSTRAINTS:
   - Automatically rejects unsafe designs (stress violations)
   - Respects geometric and operational limits
   - Ensures manufacturable result

4. OPTIMIZING THE RIGHT OBJECTIVE:
   - Maximizes expected (average) power, not peak power
   - Weights common wind speeds more than rare extremes
   - Results in practical, high-performance design

The result is a blade that produces near-maximum power under real operating 
conditions while meeting all safety and structural requirements.

================================================================================
END OF DOCUMENTATION
================================================================================
